{% extends "basic/layout.html" %}

{% set metatags %}
  {{- metatags }}
  <meta name="viewport" content="width=device-width, initial-scale=1">
{%- endset %}

{% block extrahead %}
  {%- if page_canonical_url %}
    <link rel="canonical" href="{{ page_canonical_url }}">
  {%- endif %}
  <script>
    // Avoid dark theme blink issue on refresh
    (function(){
      const root = document.documentElement
      const theme = localStorage.getItem('theme')
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)')

      if (theme == 'dark') {
        root.className = 'dark-theme'
      } else if (theme == 'light') {
        root.removeAttribute('class')
      } else {
        if (prefersDarkScheme.matches) {
          root.className = 'dark-theme'
        }
      }
    })()
  </script>
  {{ super() }}
{%- endblock %}

{% block sidebarlogo %}
  {% if pagename != "index" or theme_index_sidebar_logo %}
    {{ super() }}
  {% endif %}
{% endblock %}

{% set version_warning = current_version.banner() if current_version %}

{% block document %}
  {%- if version_warning %}
    <p class="version-warning"><strong>Warning:</strong> {{ version_warning }}</p>
  {%- endif %}
  {{- super() }}
{%- endblock %}

{% block relbar2 %}{% endblock %}

{% block sidebar2 %}
  <span id="sidebar-top"></span>
  {{- super() }}
{%- endblock %}

{% block footer %}
  {{ super() }}
  {{ js_tag("_static/version_warning_offset.js") }}
  {{ js_tag("_static/theme.js") }}
{% endblock %}
